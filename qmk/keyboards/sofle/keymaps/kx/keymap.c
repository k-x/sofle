#include QMK_KEYBOARD_H

// ------------------------------------------------------------------------------------------------------------------------------
// Layers
#define _BASE  0
#define _GAME  1
#define _NAV   2
#define _CODE  3
#define _NUM   4
#define _FN    5

// ------------------------------------------------------------------------------------------------------------------------------
#define BIT_LALT MOD_BIT(KC_LALT)
#define BIT_RALT MOD_BIT(KC_RALT)
#define BIT_LCTL MOD_BIT(KC_LCTL)
#define BIT_RCTL MOD_BIT(KC_RCTL)
#define BIT_LSFT MOD_BIT(KC_LSFT)
#define BIT_RSFT MOD_BIT(KC_RSFT)
#define BIT_LWIN MOD_BIT(KC_LGUI)
#define BIT_RWIN MOD_BIT(KC_RGUI)
#define HAS_MOD(keycode) ((get_mods() & MOD_BIT(keycode)) == MOD_BIT(keycode))

// Ctrl+Shift
#define MY_CS C(KC_LSFT) 
// Ctrl+Alt+Shift
#define CO(k) MEH(k)
//#define MY_QNAV LT(_NAV, KC_Q)
//#define MY_ANAV LT(_NAV, KC_A)
//#define MY_ZNAV LT(_NAV, KC_Z)

enum my_keycodes {
    MY_BCTL = SAFE_RANGE, // _NAV layer Ctrl that is used with the base layer
    MY_0, MY_1, MY_2, MY_3, MY_4, MY_5, MY_6, MY_7, MY_8, MY_9, // _NUM layer 
    MY_VOLU, MY_VOLD, // 10×VolUp/VolDn
    // Code layer keys:
    MY_RBL, MY_RBR, MY_SBL, MY_SBR, MY_CBL, MY_CBR
};

// ------------------------------------------------------------------------------------------------------------------------------
#include "oled.c"
#include "rgb.c"
#include "keypress.c"

// ------------------------------------------------------------------------------------------------------------------------------
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/*
 * QWERTY                                                         
 *
 * ┌───────┬───────┬───────┬───────┬───────┬───────┐                            ┌───────┬───────┬───────┬───────┬───────┬───────┐
 * │  Esc  │   1   │   2   │   3   │   4   │   5   │                            │   6   │   7   │   8   │   9   │   0   │   -   │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Tab  │   Q   │   W   │   E   │   R   │   T   │                            │   Y   │   U   │   I   │   O   │   P   │   =   │
 * │  Fx   │       │       │       │       │       │                            │       │ UPPER │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Ctrl │   A   │   S   │   D   │   F   │   G   ├───────┐            ┌───────┤   H   │   J   │   K   │   L   │   ;   │   '   │
 * │       │       │       │       │       │       │ LED − │            │ ??? − │       │       │       │ LOWER │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤ LED 0 │            │ ???   ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Code │   Z   │   X   │   C   │   V   │   B   │ LED + │            │ ??? + │   N   │   M   │   ,   │   .   │   /   │ Shift │
 * │       │       │       │       │       │       ├───────┤            ├───────┤       │       │       │       │       │       │
 * └───────┴───────┼───────┼───────┼───────┼───────┤ Shift │            │       ├───────┼───────┼───────┼───────┼───────┴───────┘
 *                 │ LAlt  │ AltGr │  Nav  │ Space │       │            │ Enter │ Space │ BSpce │  Nav  │  Win  │          
 *                 │       │       │       │       │ CapsL │            │       │       │       │       │       │          
 *                 └───────┴───────┴───────┴───────┴───────┘            └───────┴───────┴───────┴───────┴───────┘  
 */ 

[_BASE] = LAYOUT(
  KC_ESC,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                            KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_MINS,
  KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                            KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_EQL, 
  MY_BCTL, KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                            KC_H,    KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
  MO(_CODE),KC_Z,   KC_X,    KC_C,    KC_V,    KC_B,    UG_TOGG,       XXXXXXX, KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_RSFT,
                    KC_LALT, KC_RALT, TT(_NAV),KC_SPC,  LSFT_T(KC_CAPS),KC_ENT, KC_SPC,  KC_BSPC, TT(_NAV),KC_LGUI    
),

/*
 * NAVIGATION / NUMPAD
 *            
 * ┌───────┬───────┬───────┬───────┬───────┬───────┐                            ┌───────┬───────┬───────┬───────┬───────┬───────┐
 * │  Esc  │  LMB  │  MMB  │  RMB  │   *   │   −   │                            │ Calc  │  Esc  │   /   │   *   │   −   │  F21  │
 * │       │       │       │       │ Google│YouTube│                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Tab  │ ^↑    │  Home │   ↑   │  PgDn │   +   │                            │ F18   │   7   │   8   │   9   │   +   │  F22  │
 * │       │       │       │       │       │GTransl│                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │ ^Base │ Ctrl  │   ←   │  F16  │   →   │  Ins  ├───────┐            ┌───────┤ F19   │   4   │   5   │   6   │   0   │  F23  │
 * │       │       │       │Address│       │       │       │            │       │ Mahou │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Code │ Shift │  End  │   ↓   │  PgDn │  Del  │       │            │       │ F20   │   1   │   2   │   3   │   .   │ Shift │
 * │       │       │       │       │       │       ├───────┤            ├───────┤ ShreX │       │       │       │       │       │
 * └───────┴───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┴───────┘
 *                 │       │       │  Base │       │       │            │       │       │       │  Base │       │          
 *                 │       │       │       │       │       │            │       │       │       │       │       │          
 *                 └───────┴───────┴───────┴───────┴───────┘            └───────┴───────┴───────┴───────┴───────┘  
 */

[_NAV] = LAYOUT(
  _______, KC_BTN1, KC_BTN3, KC_BTN2, KC_PAST, KC_PMNS,                          KC_CALC, KC_ESC,  KC_PSLS, KC_PAST, KC_PMNS, KC_F21,
  _______, MY_CS,   KC_HOME, KC_UP,   KC_PGUP, KC_PPLS,                          KC_F18,  KC_P7,   KC_P8,   KC_P9,   KC_PPLS, KC_F22, 
  _______, KC_LCTL, KC_LEFT, KC_F16,  KC_RGHT, KC_INS,                           KC_F19,  KC_P4,   KC_P5,   KC_P6,   KC_P0,   KC_F23,
  _______, KC_LSFT, KC_END,  KC_DOWN, KC_PGDN, KC_DEL,  _______,        _______, KC_F20,  KC_P1,   KC_P2,   KC_P3,   KC_PDOT, KC_RSFT,
                    _______, _______, _______, _______, _______,        _______, _______, _______, _______, _______ 
),

/*
 * CODE / MEDIA
 *
 * ┌───────┬───────┬───────┬───────┬───────┬───────┐                            ┌───────┬───────┬───────┬───────┬───────┬───────┐
 * │  ???  │       │       │       │       │       │                            │       │       │  ()   │   (   │   )   │  ->   │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  ???  │       │ Mixer │ Vol+  │ Vol++ │       │                            │       │       │  []   │   [   │   ]   │  ===  │
 * │       │       │ MEH-S │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  ???  │       │ Prev  │ Play  │ Next  │       ├───────┐            ┌───────┤       │       │  { }  │   {   │   }   │  !==  │
 * │       │       │       │       │       │       │       │            │       │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  ???  │       │ Mute  │ Vol−  │ Vol−− │       │       │            │       │       │       │ <?php │  =>   │ <?=?> │ / * / │
 * │       │       │       │       │       │       ├───────┤            ├───────┤       │       │       │       │       │ ^!+ [ │
 * └───────┴───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┴───────┘
 *                 │  ???  │  ???  │  ???  │  ???  │  ???  │            │  ???  │  ???  │  ???  │  ???  │  ???  │          
 *                 │       │       │       │       │       │            │       │       │       │       │       │          
 *                 └───────┴───────┴───────┴───────┴───────┘            └───────┴───────┴───────┴───────┴───────┘  
 */
[_CODE] = LAYOUT(
  _______, CO(KC_1),CO(KC_2),CO(KC_3),CO(KC_4),CO(KC_5),                         CO(KC_6),CO(KC_7),CO(KC_8),MY_RBL,  MY_RBR,  CO(KC_MINS),
  _______, CO(KC_Q),CO(KC_W),KC_VOLU, MY_VOLU, CO(KC_T),                         CO(KC_Y),CO(KC_U),CO(KC_I),MY_SBL,  MY_SBR,  CO(KC_EQL),
  _______, CO(KC_A),KC_MPRV, KC_MPLY, KC_MNXT, CO(KC_G),                         CO(KC_H),CO(KC_J),CO(KC_K),MY_CBL,  MY_CBR,  CO(KC_QUOT),
  _______, CO(KC_Z),KC_MUTE, KC_VOLD, MY_VOLD, CO(KC_B),_______,        _______, CO(KC_N),CO(KC_M),CO(KC_COMM),CO(KC_DOT),CO(KC_SLSH),CO(KC_RBRC),
                    _______, _______, _______, _______, _______,        _______, _______, _______, _______, _______  
),

/**
 * Function keys layer
 */
[_FN] = LAYOUT(
  KC_F12,    KC_F1,    KC_F2,    KC_F3,    KC_F4,    KC_F5,                        KC_F6,    KC_F7,    KC_F8,    KC_F9,    KC_F10,    KC_F11,    
  XXXXXXX,   A(KC_F1), A(KC_F2), A(KC_F3), A(KC_F4), A(KC_F5),                     A(KC_F6), A(KC_F7), A(KC_F8), A(KC_F9), A(KC_F10), A(KC_F11),    
  C(KC_F12), C(KC_F1), C(KC_F2), C(KC_F3), C(KC_F4), C(KC_F5),                     C(KC_F6), C(KC_F7), C(KC_F8), C(KC_F9), C(KC_F10), C(KC_F11),    
  S(KC_F12), S(KC_F1), S(KC_F2), S(KC_F3), S(KC_F4), S(KC_F5), XXXXXXX,   XXXXXXX, S(KC_F6), S(KC_F7), S(KC_F8), S(KC_F9), S(KC_F10), S(KC_F11),    
                       XXXXXXX,  TG(_NUM), TG(_GAME),XXXXXXX,  XXXXXXX,   XXXXXXX, XXXXXXX,  XXXXXXX,  XXXXXXX,  XXXXXXX  
),


/*
 * NUMBER ROW
 *
 * ┌───────┬───────┬───────┬───────┬───────┬───────┐                            ┌───────┬───────┬───────┬───────┬───────┬───────┐
 * │       │   1   │   2   │   3   │   4   │   5   │                            │   6   │   7   │   8   │   9   │   0   │       │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │       │       │       │       │       │       ├───────┐            ┌───────┤       │       │       │       │       │       │
 * │       │       │       │       │       │       │       │            │       │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │       │       │       │       │       │       │       │            │       │       │       │       │       │       │       │
 * │       │       │       │       │       │       ├───────┤            ├───────┤       │       │       │       │       │       │
 * └───────┴───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┴───────┘
 *                 │       │       │       │       │       │            │       │       │       │       │       │          
 *                 │       │       │       │       │       │            │       │       │       │       │       │          
 *                 └───────┴───────┴───────┴───────┴───────┘            └───────┴───────┴───────┴───────┴───────┘  
 */
[_NUM] = LAYOUT(
  _______, MY_1,    MY_2,    MY_3,    MY_4,    MY_5,                             MY_6,    MY_7,    MY_8,    MY_9,    MY_0,    _______,
  _______, _______, _______, _______, _______, _______,                          _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                          _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______, _______,        _______, _______, _______, _______, _______, _______, _______,
                    _______, _______, _______, _______, _______,        _______, _______, _______, _______, _______  
),

/*
 * GAME (AS CLOSE TO THE STANDARD KEYBOARD AS POSSIBLE)
 *
 * ┌───────┬───────┬───────┬───────┬───────┬───────┐                            ┌───────┬───────┬───────┬───────┬───────┬───────┐
 * │  Esc  │   1   │   2   │   3   │   4   │   5   │                            │   6   │   7   │   8   │   9   │   0   │   -   │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Tab  │   Q   │   W   │   E   │   R   │   T   │                            │   Y   │   U   │   I   │   O   │   P   │   =   │
 * │  Fx   │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │  Ctrl │   A   │   S   │   D   │   F   │   G   ├───────┐            ┌───────┤   H   │   J   │   K   │   L   │   ;   │   '   │
 * │       │       │       │       │       │       │       │            │       │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │ Media │   Z   │   X   │   C   │   V   │   B   │       │            │       │   N   │   M   │   ,   │   .   │   /   │ Shift │
 * │       │       │       │       │       │       ├───────┤            ├───────┤       │       │       │       │       │       │
 * └───────┴───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┴───────┘
 *                 │ LAlt  │ AltGr │  Nav  │ Space │ Shift │            │ Enter │ Space │ BSpce │  Nav  │  Win  │          
 *                 │       │       │no lock│       │       │            │       │       │       │no lock│       │          
 *                 └───────┴───────┴───────┴───────┴───────┘            └───────┴───────┴───────┴───────┴───────┘  
 */
[_GAME] = LAYOUT(
  _______, KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                            KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_MINS,
  _______, KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                            KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_EQL, 
  _______, KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                            KC_H,    KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
  _______, KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,    _______,       _______, KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_RSFT,
                    KC_LALT, KC_RALT, MO(_NAV),KC_SPC,  KC_LSFT,       KC_ENT,  KC_SPC,  KC_BSPC, MO(_NAV),KC_RGUI  
),


/*
 *
 * ┌───────┬───────┬───────┬───────┬───────┬───────┐                            ┌───────┬───────┬───────┬───────┬───────┬───────┐
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * │       │       │       │       │       │       │                            │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤                            ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │       │       │       │       │       │       ├───────┐            ┌───────┤       │       │       │       │       │       │
 * │       │       │       │       │       │       │       │            │       │       │       │       │       │       │       │
 * ├───────┼───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┼───────┤
 * │       │       │       │       │       │       │       │            │       │       │       │       │       │       │       │
 * │       │       │       │       │       │       ├───────┤            ├───────┤       │       │       │       │       │       │
 * └───────┴───────┼───────┼───────┼───────┼───────┤       │            │       ├───────┼───────┼───────┼───────┼───────┴───────┘
 *                 │       │       │       │       │       │            │       │       │       │       │       │          
 *                 │       │       │       │       │       │            │       │       │       │       │       │          
 *                 └───────┴───────┴───────┴───────┴───────┘            └───────┴───────┴───────┴───────┴───────┘  
 
[_X] = LAYOUT(
  _______, _______, _______, _______, _______, _______,                          _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                          _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                          _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______, _______,        _______, _______, _______, _______, _______, _______, _______,
                    _______, _______, _______, _______, _______,        _______, _______, _______, _______, _______  
),

 */

};


#if defined(ENCODER_MAP_ENABLE)
const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][NUM_DIRECTIONS] = {
    [_BASE] = { ENCODER_CCW_CW(UG_VALD, UG_VALU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_NAV]  = { ENCODER_CCW_CW(UG_VALD, UG_VALU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_CODE] = { ENCODER_CCW_CW(UG_VALD, UG_VALU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_FN]   = { ENCODER_CCW_CW(UG_VALD, UG_VALU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_GAME] = { ENCODER_CCW_CW(UG_VALD, UG_VALU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_NUM]  = { ENCODER_CCW_CW(UG_VALD, UG_VALU), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) }
};
#endif